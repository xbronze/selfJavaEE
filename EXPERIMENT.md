## 实验

### 第四章 Spring AOP

#### 案例内容

学生管理系统一般包括用户模块、学生信息模块和学生成绩模块。其中，用户模块则实现学生、教师登录和退出功能；学生信息和学生成绩模块实现添加、更新、查询信息和成绩功能。由于学生只能查询本人的信息和成绩，所以每次执行操作前需要进行权限验证。而且每次操作都需要记录，以便系统后续的管理和维护。本案例将通过Spring AOP来实现学生管理系统。



#### 案例分析

（1）使用基于注解的AOP实现学生管理系统。

（2）创建用户管理接口及其实现类，在接口中定义登录和退出登录方法；在类中定义账号、密码和身份静态属性，以及获取账号和身份方法，然后重写登录和退出登录方法。

（3）创建学生信息管理接口及其实现类，并接口中定义方法，以及在类中重写方法，实现添加、更新和查询学生信息功能。

（4）创建学生成绩成绩接口及其实现类，并接口中定义方法，以及在类中重写方法，实现添加、更新和查询学生成绩功能。

（5）创建切面类，在类中定义方法获取当前时间、前置通知实现权限验证、环绕通知实现记录操作、异常通知实现记录异常信息。其中，权限验证通过用户账号和身份判断学生是否能执行当前操作，如果能则执行当前操作，否则抛出异常，中断程序。

（6）创建配置文件，在文件中指定扫描的包，并开启Bean的自动扫描功能和AOP自动配置功能。

（7）创建执行类，在类中获取用户管理类、学生信息管理类和学生成绩管理类的Bean，然后通过Bean调用相关方法，实现登录和退出系统、查询学生信息和成绩功能。



### 第五章 Spring数据库编程

#### 案例内容

学生管理系统的用户、学生、成绩和待选课程信息都应保存在数据库中，以便后续更新或查询。而且学生在选课时，待选课程表中对应的课程剩余名额需要减1，选课信息表中应添加对应的选课信息，保持数据库中数据的统一和完整。如果在选课过程中出现异常，则需要使用事务回滚。本案例将通过Spring实现学生管理系统数据库操作，已经创建了数据库db_student，以及用户信息表users、学生成绩表scores和待选课程表courses，3个表中的数据如图5-6所示。创建数据库和表及插入数据的过程可扫码查看。

![图片1](https://img.picgo.net/2024/09/06/10df176b9c154f543.png)

#### 案例分析

（1）使用注解实现学生管理系统数据库操作。

（2）创建用户类，并将其标注为Bean。在类中定义账号、密码和身份属性，以及其设置和获取方法，然后定义返回属性信息方法。

（3）创建用户管理接口及其实现类，并将类标注为Bean，在接口中定义登录和退出登录方法并在类中重写。在登录方法中，根据用户信息从用户信息表中查询用户记录，如果查询的用户记录不为空，返回true，否则返回false。

（4）创建学生成绩类，并将其标注为Bean。在类中定义学号、语文成绩、数学成绩和英语成绩属性，以及其设置和获取方法，然后定义返回属性信息方法。

（5）创建成绩管理接口及其实现类，并将类标注为Bean，在接口中定义插入、更新、按学号查询单个和查询所有学生成绩记录方法并在类中重写。

（6）创建待选课程类，并将其标注为Bean。在类中定义电影、广告、公共关系属性，以及其设置和获取方法，然后定义返回属性信息方法。

（7）创建待选课程管理接口及其实现类，并将类标注为Bean，然后在接口中定义更新、查询待选课程记录和选课方法并在类中重写。

（8）创建配置文件，在文件中配置数据源、JDBC模板和事务管理器，并开启自动扫描和使用注解事务管理功能。

（9）创建执行类，实现教师用户登录，执行插入和更新一条学生成绩记录，以及查询所有的学生成绩记录操作；然后实现学生用户登录，执行查询本人的成绩记录和选课操作。

（10）在待选课程管理类的选课方法中添加代码模拟异常，然后在执行类中修改教师用户的密码实现教师用户不登录。